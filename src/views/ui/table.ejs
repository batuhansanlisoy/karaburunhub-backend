<div class="table-widget-container">
  <div class="table-widget-body table-responsive">
    <table class="table table-dark table-striped table-hover align-middle mb-0 rounded">
      <thead class="table-secondary text-dark">
        <tr id="dynamicTableHead"></tr>
      </thead>
      <tbody id="dynamicTableBody"></tbody>
    </table>
  </div>
</div>

<script>
function capitalizeFirstLetter(str) {
    if (!str || str === '-') return str;
    return str.charAt(0).toUpperCase() + str.slice(1);
}

function renderTable(columns, data, deleteUrl) {
    const tableHead = document.getElementById('dynamicTableHead');
    const tableBody = document.getElementById('dynamicTableBody');

    // Table Head
    tableHead.innerHTML = '';
    columns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = col.label;
        th.classList.add('align-middle', 'py-2', 'ps-4');
        if (col.width) th.style.width = col.width; // ğŸ‘ˆ width ekleme
        tableHead.appendChild(th);
    });

    // Table Body
    tableBody.innerHTML = '';
    data.forEach(row => {
        const tr = document.createElement('tr');
        tr.classList.add('align-middle');

        columns.forEach(col => {
            const td = document.createElement('td');
            td.classList.add('py-2', 'ps-4');
            if (col.width) td.style.width = col.width; // ğŸ‘ˆ body hÃ¼crelerine de uygula

            let value = row[col.key] ?? '-';

            // Type bazlÄ± formatlama
            if (col.type === 'phone' && value && value !== '-') {
                const digits = value.replace(/\D/g, '');
                value = digits.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
                td.textContent = value;
            } 
            else if (col.type === 'date' && value && value !== '-') {
                const date = new Date(value);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                td.textContent = `${day}/${month}/${year}`;
            } 
            else if (col.type === 'html' && value) {
                td.innerHTML = value;
            } 
            else {
                td.textContent = capitalizeFirstLetter(value);
            }

            tr.appendChild(td);
        });

        tableBody.appendChild(tr);
    });

    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
            const id = btn.dataset.id;
            if (!id) return;

            if (!confirm("Bu kaydÄ± silmek istediÄŸine emin misin?")) return;

            try {
                const res = await fetch(`${deleteUrl}/${id}`, { method: 'DELETE' });
                if (res.ok) {
                    alert("KayÄ±t baÅŸarÄ±yla silindi!");
                    location.reload();
                } else {
                    const data = await res.json();
                    alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z: " + (data.error || "Bilinmeyen hata"));
                }
            } catch (err) {
                console.error(err);
                alert("Silme sÄ±rasÄ±nda hata oluÅŸtu");
            }
        });
    });
}
</script>
