<div class="table-widget-container">
  <div class="table-widget-body table-responsive">
    <table class="table table-dark table-striped table-hover align-middle mb-0 custom-table">
      <thead class="table-header text-white">
        <tr id="dynamicTableHead"></tr>
      </thead>
      <tbody id="dynamicTableBody"></tbody>
    </table>
  </div>
</div>

<script>
function capitalizeFirstLetter(str) {
    if (!str || str === '-') return str;
    return str.charAt(0).toUpperCase() + str.slice(1);
}

function renderTable(columns, data, deleteUrl) {
    const tableHead = document.getElementById('dynamicTableHead');
    const tableBody = document.getElementById('dynamicTableBody');

    // Table Head
    tableHead.innerHTML = '';
    columns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = col.label;
        th.classList.add('align-middle', 'py-2', 'ps-4');
        if (col.width) th.style.width = col.width;
        tableHead.appendChild(th);
    });

    // Table Body
    tableBody.innerHTML = '';
    data.forEach(row => {
        const tr = document.createElement('tr');
        tr.classList.add('align-middle');

        columns.forEach(col => {
            const td = document.createElement('td');
            td.classList.add('py-2', 'ps-4');
            if (col.width) td.style.width = col.width;

            let value = row[col.key] ?? '-';

            if (col.type === 'phone' && value && value !== '-') {
                const digits = value.replace(/\D/g, '');
                value = digits.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
                td.textContent = value;
            } 
            else if (col.type === 'date' && value && value !== '-') {
                const date = new Date(value);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                td.textContent = `${day}/${month}/${year}`;
            } 
            else if (col.type === 'html' && value) {
                td.innerHTML = value;
            } 
            else {
                td.textContent = capitalizeFirstLetter(value);
            }

            tr.appendChild(td);
        });

        tableBody.appendChild(tr);
    });

    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
            const id = btn.dataset.id;
            if (!id) return;

            if (!confirm("Bu kaydÄ± silmek istediÄŸine emin misin?")) return;

            try {
                const res = await fetch(`${deleteUrl}/${id}`, { method: 'DELETE' });
                if (res.ok) {
                    alert("KayÄ±t baÅŸarÄ±yla silindi!");
                    location.reload();
                } else {
                    const data = await res.json();
                    alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z: " + (data.error || "Bilinmeyen hata"));
                }
            } catch (err) {
                console.error(err);
                alert("Silme sÄ±rasÄ±nda hata oluÅŸtu");
            }
        });
    });
}
</script>

<style>
/* ğŸ”¹ Tablonun kapsayÄ±cÄ± container'Ä± */
.table-widget-container {
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.35);
}

/* ğŸ”¹ Tablo genel gÃ¶rÃ¼nÃ¼mÃ¼ */
.custom-table {
    border-collapse: collapse;
    width: 100%;
    background: #1f1f1f;
}

/* ğŸ”¹ Header */
.table-header {
    background: linear-gradient(90deg, #3b82f6, #06b6d4);
}

.table-header th {
    font-weight: 600;
    font-size: 15px;
    padding: 14px;
    border: none !important;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #fff;
}

/* ğŸ”¹ SatÄ±rlar */
.custom-table td {
    border: none !important;
    padding: 12px 16px;
    color: #e5e5e5;
    background-color: transparent;
    transition: background-color 0.25s ease, color 0.25s ease;
}

/* ğŸ”¹ Alternatif satÄ±r rengi (striped) */
.custom-table tbody tr:nth-child(odd) {
    background-color: rgba(255, 255, 255, 0.03);
}

/* ğŸ”¹ Hover efekti */
.custom-table tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.07);
    /* transform: scale(1.01); */
    transition: transform 0.2s ease, background-color 0.3s ease;
}
</style>
